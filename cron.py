beaches = {
    "Imperial Beach Pier": ["https://www.surfline.com/surf-report/imperial-pier-northside/5842041f4e65fad6a7708847", 3, 33.1422015, -118.0627561],
    "Ocean Beach Pier": ["https://www.surfline.com/surf-report/ocean-beach-pier-/59aedf63b5e8310014bbe375", 0, 32.7443973, -117.2615996],
    "Ocean Beach Jetty": ["https://www.surfline.com/surf-report/ocean-beach/5842041f4e65fad6a770883f", 3, 32.7471113, -117.2636047],
    "Mission Beach": ["https://www.surfline.com/surf-report/mission-beach/5842041f4e65fad6a7708842", 3, 32.7879624, -117.2918774],
    "Pacific Beach Pier": ["https://www.surfline.com/surf-report/pacific-beach/5842041f4e65fad6a7708841", 3, 32.7962674, -117.2590454],
    "Windansea": ["https://www.surfline.com/surf-report/windansea/5842041f4e65fad6a770883c", 3, 32.8311579, -117.2899036],
    "Scripps Pier": ["https://www.surfline.com/surf-report/scripps-pier-northside/5d703b2ae4a3a8000133196a", 3, 32.8662843, -117.2568256],
    "Del Mar Beach": ["https://www.surfline.com/surf-report/del-mar/5d7687fdb4c559000112e666", 3, 32.9595213, -117.2685396],
    "Del Mar Rivermouth": ["https://www.surfline.com/surf-report/del-mar-rivermouth/5842041f4e65fad6a77088b0", 3, 32.9712155, -117.2673769],
    "Seaside Reef": ["https://www.surfline.com/surf-report/seaside-reef/5842041f4e65fad6a77088b3", 3, 33.0007203, -117.2784916],
    "Cardiff Reef": ["https://www.surfline.com/surf-report/cardiff-reef-south/584204214e65fad6a7709d19", 3, 33.0062688, -117.2971396],
    "Swamis": ["https://www.surfline.com/surf-report/swami-s/5842041f4e65fad6a77088b4", 3, 33.0356447, -117.2954494],
    "Tamarack": ["https://www.surfline.com/surf-report/tamarack/5842041f4e65fad6a7708837", 3, 33.1439698,-117.3482225],
    "Carlsbad State Beach": ["https://www.surfline.com/surf-report/carlsbad-state-beach-north/5d4dc10680c2430001b119fb", 3, 33.1504987,-117.3524959],
    "Blacks": ["https://www.surfline.com/surf-report/blacks/5842041f4e65fad6a770883b", 3, 32.8907, -117.2535],
    "Oceanside Pier": ["https://www.surfline.com/surf-report/oceanside-pier-northside/5842041f4e65fad6a7708835", 3, 33.1934, -117.3860],
    "Lowers": ["https://www.surfline.com/surf-report/lower-trestles/5842041f4e65fad6a770888a", 2, 33.3853, -117.5939],
    "Uppers": ["https://www.surfline.com/surf-report/upper-trestles/5842041f4e65fad6a7708887", 2, 33.3853155, -117.5975894],
    "T Street": ["https://www.surfline.com/surf-report/t-street/5842041f4e65fad6a7708830", 3, 33.4163673, -117.6264938],
    "San Clemente Pier": ["https://www.surfline.com/surf-report/san-clemente-pier-northside/5cc8b55739a02e0001ac69f8", 3, 33.4190257, -117.6233728],
    "Doheny": ["https://www.surfline.com/surf-report/doheny-state-beach/5842041f4e65fad6a77088d7", 0, 33.4610133, -117.686342],
    "Salt Creek": ["https://www.surfline.com/surf-report/salt-creek-overview/584204204e65fad6a770938b", 3, 33.4760643, -117.7250302],
    "The Wedge": ["https://www.surfline.com/surf-report/the-wedge/5842041f4e65fad6a770882b", 0, 33.5928523, -117.8897922],
    "Newport Jetties": ["https://www.surfline.com/surf-report/newport-jetties/5842041f4e65fad6a77088f6", 0, 33.620926, -117.9442217],
    "56th St": ["https://www.surfline.com/surf-report/56th-street-close-up/5a26e1ba9caa98001b09d0e7", 2, 33.6229, -117.9467],
    "Huntington State Beach": ["https://www.surfline.com/surf-report/huntington-state-beach/584204204e65fad6a770998c", 3, 33.6380444, -117.9758009],
    "Huntington Beach Pier": ["https://www.surfline.com/surf-report/hb-pier-northside/5842041f4e65fad6a7708827", 2, 33.654907, -118.004375],
    "HB 17th St": ["https://www.surfline.com/surf-report/17th-st-/5842041f4e65fad6a77088eb", 3, 33.664079, -118.0150748],
    "Goldenwest": ["https://www.surfline.com/surf-report/goldenwest/5842041f4e65fad6a77088ea", 3, 33.668239, -118.0203707],
    "Bolsa Chica": ["https://www.surfline.com/surf-report/bolsa-chica-state-beach-n-/58bdee240cec4200133464f1", 3, 33.6972793, -118.0683508],
    "Lunada Bay": ["https://www.surfline.com/surf-report/lunada-bay/5842041f4e65fad6a770892c", 0, 33.771444, -118.4244907],
    "Haggertys": ["https://www.surfline.com/surf-report/haggerty-s/5842041f4e65fad6a7708920", 0, 33.777012, -118.4274737],
    "Hermosa Beach Pier": ["https://www.surfline.com/surf-report/hermosa-pier-southside/5b17293b9f631f001a010d54", 3, 33.8612058, -118.4077313],
    "Hermosa Beach": ["https://www.surfline.com/surf-report/hermosa-beach/5842041f4e65fad6a7708904", 3, 33.8646935, -118.4149244],
    "Manhattan Beach Pier": ["https://www.surfline.com/surf-report/manhattan-pier-northside/5acd24954031e5001a13854a", 3, 33.8894932, -118.4186522],
    "El Porto": ["https://www.surfline.com/surf-report/el-porto/5842041f4e65fad6a7708906", 3, 33.9038, -118.4192],
    "Topanga": ["https://www.surfline.com/surf-report/topanga-beach/5842041f4e65fad6a770881e", 2, 34.0385874, -118.5910254],
    "Malibu": ["https://www.surfline.com/surf-report/malibu-second-to-third-point/5842041f4e65fad6a7708817", 2, 34.0363, -118.6779],
    "Point Dume": ["https://www.surfline.com/surf-report/point-dume/5842041f4e65fad6a7708936", 2, 34.001201, -118.8086307],
    "Zuma": ["https://www.surfline.com/surf-report/zuma-beach-north/5b156d394a274e001a11fb62", 2, 34.0218023, -118.8486992],
    "Leo Carillo": ["https://www.surfline.com/surf-report/leo-carrillo/5842041f4e65fad6a770893f", 2, 34.0440831, -118.947005],
    "County Line": ["https://www.surfline.com/surf-report/county-line/5842041f4e65fad6a7708813", 2, 34.0514, -118.9600],
    "Ventura Harbor": ["https://www.surfline.com/surf-report/ventura-harbor/5842041f4e65fad6a7708811", 3, 34.245624, -119.263642],
    "Ventura Point": ["https://www.surfline.com/surf-report/ventura-point/584204204e65fad6a77096b1", 3, 34.2743, -119.2992],
    "Faria": ["https://www.surfline.com/surf-report/pitas-point/5842041f4e65fad6a7708957", 3, 34.324963, -119.395704],
    "Rincon": ["https://www.surfline.com/surf-report/rincon/5842041f4e65fad6a7708814", 3, 34.3741622, -119.4767872],
    "Pismo Beach Pier": ["https://www.surfline.com/surf-report/pismo-beach-pier/5842041f4e65fad6a77089ac", 3, 35.138287, -120.644732],
    "Morro Bay": ["https://www.surfline.com/surf-report/morro-bay/5842041f4e65fad6a770880a", 0, 35.3694, -120.8677],
    "Cayucos Pier": ["https://www.surfline.com/surf-report/cayucos-pier/5842041f4e65fad6a77089a2", 3, 35.4493, -120.9064],
    "Pleasure Point": ["https://www.surfline.com/surf-report/pleasure-point/5842041f4e65fad6a7708807", 2, 36.9635, -121.9649],
    "Steamer Lane": ["https://www.surfline.com/surf-report/steamer-lane/5842041f4e65fad6a7708805", 2, 36.9517, -122.0261],
    "Waddell Creek": ["https://www.surfline.com/surf-report/waddell-creek/5842041f4e65fad6a7708980", 3, 37.0963, -122.2782],
    "Ocean Beach": ["https://www.surfline.com/surf-report/north-ocean-beach/5d9b68deab58860001c7359e", 3, 37.7594, -122.5107],
    "Dead Mans": ["https://www.surfline.com/surf-report/fort-point/5842041f4e65fad6a770897a", 0, 37.8106, -122.4771],
    "Vilano": ["https://www.surfline.com/surf-report/vilano/5842041f4e65fad6a7708aa5", 1, 29.9359254, -81.3389262],
    "A1A Gas Station": ["https://www.surfline.com/surf-report/gate-station/5842041f4e65fad6a7708a9b", 1, 30.0224542, -81.3252771],
    "Micklers": ["https://www.surfline.com/surf-report/crossroads/5842041f4e65fad6a7708a8a", 1, 30.1616135, -81.3575616],
    "The Lodge": ["https://www.surfline.com/surf-report/sawgrass/5842041f4e65fad6a7708a8b", 1, 30.2201983, -81.3735406],
    "8th Ave": ["https://www.surfline.com/surf-report/8th-ave-south/584204214e65fad6a7709bc7", 1, 30.2810763, -81.3898893],
    "Jax Beach Pier": ["https://www.surfline.com/surf-report/jacksonville-pier-southside/5c4798f0f5f7d0000136e94f", 1, 30.2932266, -81.3914165],
    "Neptune Beach": ["https://www.surfline.com/surf-report/neptune-beach/584204214e65fad6a7709d0f", 1, 30.3132981, -81.3949989],
    "Atlantic Beach": ["https://www.surfline.com/surf-report/atlantic-beach/5842041f4e65fad6a7708a98", 1, 30.3334631, -81.4022438],
    "The Poles": ["https://www.surfline.com/surf-report/mayport-poles/5842041f4e65fad6a7708a8d", 1, 30.3724544, -81.3986815]
}

from bs4 import BeautifulSoup
import requests
import re

dirs = ['N', 'E', 'S', 'W']

def get_swells(soup):
    swells = soup.find_all('div', {'class':'quiver-swell-measurements'})
    return swells

def clean_swells(swells):
    clean_swells = []
    for swell in swells:
        clean_swells.append(swell.get_text())
    return clean_swells

def get_swell_height(swell):
    return swell.split(' ')[0].split('FT')[0]

def get_swell_period(swell):
    return swell.split(' ')[2].split('s')[0]

def get_swell_dir(swell):
    dir_str =  swell.split(' ')[3][0]
    for i in range(len(dirs)):
        if dir_str == dirs[i]:
            return i
    return 0

def get_wind(soup):
    wind = soup.find('div', {'class': 'quiver-spot-forecast-summary__stat-container quiver-spot-forecast-summary__stat-container--wind'})
    return re.sub(r'Wind', '', re.sub(r'KTS', " ", wind.get_text()))

def get_wind_dir(wind):
    wind_str = wind.split(" ")[1][0]
    for i in range(len(dirs)):
        if wind_str == dirs[i]:
            return i
    return 0

def get_wind_speed(wind):
    return wind.split(" ")[0]


def get_tide(soup):
    tide = soup.find('div', {'class':'quiver-spot-forecast-summary__stat-container quiver-spot-forecast-summary__stat-container--tide'})
    return re.sub(r'Tide','', tide.get_text()).split('FT')[0]


def get_water_temp(soup):
    temp = soup.find('div', {'class': 'quiver-water-temp'})
    return re.sub(r'Water Temp', '', temp.get_text()).split(' - ')[0]


def height_period_dir_dict(clean_swlls):
    height_period_dir_dict = {}
    for swell in clean_swlls:
        height_period_dir_dict[float(get_swell_height(swell))] = [int(get_swell_period(swell)), get_swell_dir(swell)]
    return height_period_dir_dict


def get_longest_period_swell(dict):
    longest = 0
    ans = [-1,-1,-1]
    for key in dict.keys():
        if dict[key][0] > longest:
            ans[0] = key
            ans[1] = dict[key][0]
            ans[2] = dict[key][1]
            longest = dict[key][0]
    return ans


def get_tallest_height(dict):
    tallest = 0
    ans = [-1, -1, -1]
    for key in dict.keys():
        if key > tallest:
            ans[0] = key
            ans[1] = dict[key][0]
            ans[2] = dict[key][1]
            tallest = key
    return ans

def update_beach_api(name, url, beach_dir, lat, lng):
    res = requests.get(url)
    soup = BeautifulSoup(res.text, 'lxml') #lxml is a pareser library for structured data
    #wind data
    wind = get_wind(soup)
    wind_speed = get_wind_speed(wind)
    wind_dir = get_wind_dir(wind)
    #swell data
    swells = get_swells(soup)
    clean_swlls = clean_swells(swells)
    #get swell data
    dict = height_period_dir_dict(clean_swlls)
    swell1 = get_longest_period_swell(dict)
    swell1_ht, swell1_pd, swell1_dir = swell1[0], swell1[1], swell1[2]
    swell2 = get_tallest_height(dict)
    swell2_ht, swell2_pd, swell2_dir = swell2[0], swell2[1], swell2[2]
    #tide data
    tide = get_tide(soup)
    #water_temp_data
    temp = get_water_temp(soup)
    data = {
        'name': name,
        'surfline_url': url,
        'latitude': float(lat),
        'longitude': float(lng),
        'beach_dir': beach_dir,
        'wind_speed': wind_speed,
        'wind_dir': wind_dir,
        'swell1_height': float(swell1_ht),
        'swell2_height': float(swell2_ht),
        'swell1_period': swell1_pd,
        'swell2_period': swell2_pd,
        'swell1_dir': swell1_dir,
        'swell2_dir': swell2_dir,
        'tide_height': float(tide),
        'water_temp': int(temp)
    }

    res = requests.post("https://optimal-stoke.herokuapp.com/update_beach", data = data)
    return res

for name in beaches.keys():
    print(name)
    x = update_beach_api(name, beaches[name][0], beaches[name][1], beaches[name][2], beaches[name][3])
    print(x)
